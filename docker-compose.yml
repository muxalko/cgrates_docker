version: '3.7'
services:
  redis:
    image: 'bitnami/redis:4.0.11'
    container_name: redis
    hostname: redis
    volumes:
      - '/traces/redis:/bitnami/redis'
    environment:
      - REDIS_REPLICATION_MODE=master
      - ALLOW_EMPTY_PASSWORD=yes
    networks:
      - redis-net
    logging:
      driver: json-file
      options:
        max-size: 100m
        max-file: '1'
    sysctls:
      net.core.somaxconn: '1024'
  dynomite:
    image: 'gitlab-ptk.gt.local:5005/dynomite'
    container_name: dynomite
    restart: always
    env_file:
      - ./env/${HOSTNAME}.env
    volumes:
      - './configs/dynomite/${HOSTNAME}:/etc/dynomite'
    networks:
      - redis-net
      - dynomite-net
    ports:
      - '${EXPOSE_DYNO_CLIENT}:8101'
      - '${EXPOSE_DYNO_STATS}:22222'
    extra_hosts:
      - 'cgr-lab-ptk-01:10.224.228.188'
      - 'cgr-lab-hfa-01:10.192.196.188'
      - 'ppcc-cgr-ptk-node-01:10.224.243.54'
      - 'ppcc-cgr-hfa-node-01:10.192.211.54'
    logging:
      driver: json-file
      options:
        max-size: 100m
        max-file: '1'
  rals:
    image: 'gitlab-ptk.gt.local:5005/cgr-engine:${CGRATES_VERSION_TAG}'
    container_name: rals
    restart: always
    env_file:
      - ./env/${HOSTNAME}.env
    volumes:
      - './configs/cgrates/common:/etc/cgrates/common'
      - './configs/cgrates/rals:/etc/cgrates/rals'
    networks:
      - dynomite-net
      - rals-net
    extra_hosts:
      - 'cgr-lab-ptk-01:10.224.228.188'
      - 'cgr-lab-hfa-01:10.192.196.188'
      - 'ocs-db-ptk-node-01:10.224.243.58'
      - 'ocs-db-hfa-node-01:10.192.211.58'
    environment:
      - CGR-SERVICE=rals
    logging:
      driver: json-file
      options:
        max-size: 100m
        max-file: '1'
  cdrs:
    image: 'gitlab-ptk.gt.local:5005/cgr-engine:${CGRATES_VERSION_TAG}'
    container_name: cdrs
    restart: always
    env_file:
      - ./env/${HOSTNAME}.env
    volumes:
      - './configs/cgrates/common:/etc/cgrates/common'
      - './configs/cgrates/cdrs:/etc/cgrates/cdrs'
    networks:
      - rals-net
      - sessions-net
    extra_hosts:
      - 'cgr-lab-ptk-01:10.224.228.188'
      - 'cgr-lab-hfa-01:10.192.196.188'
      - 'ocs-db-ptk-node-01:10.224.243.58'
      - 'ocs-db-hfa-node-01:10.192.211.58'
    environment:
      - CGR-SERVICE=cdrs
    logging:
      driver: json-file
      options:
        max-size: 100m
        max-file: '1'
  attributes:
    image: 'gitlab-ptk.gt.local:5005/cgr-engine:${CGRATES_VERSION_TAG}'
    container_name: attributes
    restart: always
    env_file:
      - ./env/${HOSTNAME}.env
    volumes:
      - './configs/cgrates/common:/etc/cgrates/common'
      - './configs/cgrates/attributes:/etc/cgrates/attributes'
    networks:
      - dynomite-net
      - rals-net
      - sessions-net
    ports:
      - '${EXPOSE_ATTR}:${LISTEN_HTTP}'
    environment:
      - CGR-SERVICE=attributes
    logging:
      driver: json-file
      options:
        max-size: 100m
        max-file: '1'
  sessions:
    image: 'gitlab-ptk.gt.local:5005/cgr-engine:${CGRATES_VERSION_TAG}'
    container_name: sessions
    restart: always
    env_file:
      - ./env/${HOSTNAME}.env
    volumes:
      - './configs/cgrates/common:/etc/cgrates/common'
      - './configs/cgrates/sessions:/etc/cgrates/sessions'
    networks:
      - rals-net
      - sessions-net
    ports:
      - '${EXPOSE_SESS}:${LISTEN_HTTP}'
    environment:
      - CGR-SERVICE=sessions
    logging:
      driver: json-file
      options:
        max-size: 100m
        max-file: '1'
  diameter:
    image: 'gitlab-ptk.gt.local:5005/cgr-engine:${CGRATES_VERSION_TAG}'
    container_name: diameter
    restart: always
    env_file:
      - ./env/${HOSTNAME}.env
    environment:
      - CGR-SERVICE=diameter
    volumes:
      - './configs/cgrates/common:/etc/cgrates/common'
      - './configs/cgrates/diameter:/etc/cgrates/diameter'
    ports:
      - '${EXPOSE_DA}:${LISTEN_DA}'
    networks:
      - sessions-net
    logging:
      driver: json-file
      options:
        max-size: 100m
        max-file: '1'
  api:
    image: 'gitlab-ptk.gt.local:5005/cgr-engine:${CGRATES_VERSION_TAG}'
    container_name: api
    restart: always
    env_file:
      - ./env/${HOSTNAME}.env
    volumes:
      - './configs/cgrates/common:/etc/cgrates/common'
      - './configs/cgrates/api:/etc/cgrates/api'
    ports:
      - '${EXPOSE_API}:${LISTEN_HTTP}'
    networks:
      - dynomite-net
    extra_hosts:
      - 'cgr-lab-ptk-01:10.224.228.188'
      - 'cgr-lab-hfa-01:10.192.196.188'
      - 'ocs-db-ptk-node-01:10.224.243.58'
      - 'ocs-db-hfa-node-01:10.192.211.58'
    environment:
      - CGR-SERVICE=api
    logging:
      driver: json-file
      options:
        max-size: 100m
        max-file: '1'
networks:
  dynomite-net: null
  redis-net: null
  rals-net: null
  sessions-net: null
